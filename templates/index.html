<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XWAVE XLITCH ART</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1a;
            --card-bg: #252525;
            --accent-color: #00c896;
            --text-color: #e0e0e0;
            --text-secondary: #a0a0a0;
            --border-color: #333;
            --input-bg: #333;
            --error-color: #ff5252;
            --success-color: #4caf50;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            max-width: 100%;
            overflow-x: hidden;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: var(--accent-color);
            font-size: 2.5rem;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            body {
                padding: 10px;
            }
        }
        
        .form-container {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            max-width: 100%;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-group {
            flex: 1 1 300px;
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .form-group {
                flex: 1 1 100%;
            }
            
            .form-row {
                flex-direction: column;
                gap: 10px;
            }
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-color);
            font-weight: 500;
        }
        
        .required-field::after {
            content: "";
            color: var(--accent-color);
        }
        
        input[type="text"],
        input[type="number"],
        input[type="file"],
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--input-bg);
            color: var(--text-color);
            font-size: 16px;
        }
        
        input[type="file"] {
            padding: 8px;
            cursor: pointer;
        }
        
        .chunk-size-inputs {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chunk-size-inputs input {
            flex: 1;
        }
        
        .chunk-size-inputs span {
            font-weight: bold;
            color: var(--text-secondary);
        }
        
        button {
            background-color: var(--accent-color);
            color: #fff;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background-color 0.2s;
            display: inline-block;
            text-align: center;
            margin-top: 10px;
        }
        
        button:hover {
            background-color: #00b084;
        }
        
        .effect-fields {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        
        .effect-fields h3 {
            margin-bottom: 15px;
            color: var(--accent-color);
        }
        
        .nested-fields {
            margin-top: 15px;
            margin-left: 15px;
            padding: 15px;
            border-left: 3px solid var(--accent-color);
            background-color: rgba(0, 200, 150, 0.05);
        }
        
        .help-text {
            display: block;
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 5px;
        }
        
        .error-message {
            color: var(--error-color);
            background-color: rgba(255, 82, 82, 0.1);
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .alert {
            padding: 12px 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .alert-info {
            color: #0288d1;
            background-color: rgba(2, 136, 209, 0.1);
            border: 1px solid rgba(2, 136, 209, 0.2);
        }
        
        .resize-notification {
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .global-error {
            margin-top: 10px;
        }
        
        .has-error input,
        .has-error select {
            border-color: var(--error-color);
        }
        
        #image-preview, #processed-container {
            margin-top: 30px;
            text-align: center;
        }
        
        .preview-container {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .preview-container h2 {
            margin-bottom: 15px;
            color: var(--accent-color);
        }
        
        .preview-image {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .action-buttons a, 
        .action-buttons button {
            padding: 10px 15px;
            background-color: var(--accent-color);
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 120px;
        }
        
        .action-buttons a:hover, 
        .action-buttons button:hover {
            background-color: #00b084;
            transform: translateY(-2px);
        }
        
        #loading {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--accent-color);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        #debug-info {
            margin-top: 30px;
            padding: 15px;
            background-color: var(--card-bg);
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            color: var(--text-secondary);
            white-space: pre-wrap;
            overflow-x: auto;
            display: none;
        }
        
        /* Mobile-specific styles */
        @media (max-width: 480px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .form-container, .preview-container {
                padding: 15px;
                border-radius: 6px;
            }
            
            button, .action-buttons a, .action-buttons button {
                width: 100%;
                padding: 12px 10px;
                font-size: 14px;
                min-width: unset;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            input[type="text"],
            input[type="number"],
            input[type="file"],
            select {
                font-size: 14px;
                padding: 8px;
            }
            
            .effect-fields h3 {
                font-size: 1.2rem;
            }
        }
        
        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
        }

        @media (max-width: 768px) {
            .form-container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="main-content">
        <h1>XWAVE XLITCH ART</h1>
        <div class="form-container">
            <form method="POST" enctype="multipart/form-data" id="image-form">
                {{ form.csrf_token }} 
                
                <div class="form-row">
                    <div class="form-group" id="form-group-primary_image">
                        {{ form.primary_image.label(class_="required-field") }}
                        {{ form.primary_image(class_="form-control-file", onchange="previewImage(event)", id="primary-image-input") }}
                        {% if form.primary_image.errors %}
                            <ul class="error-message">{% for error in form.primary_image.errors %}<li>{{ error }}</li>{% endfor %}</ul>
                        {% endif %}
                    </div>
                    <div class="form-group" id="form-group-effect">
                        {{ form.effect.label(class_="required-field") }}
                        {{ form.effect(class_="form-control", id="effect") }}
                        {% if form.effect.errors %}
                            <ul class="error-message">{% for error in form.effect.errors %}<li>{{ error }}</li>{% endfor %}</ul>
                        {% endif %}
                    </div>
                </div>

                <div id="effect-specific-fields-container" class="effect-fields">
                    {# Initial rendering of specific form fields if available (e.g., on page load with selection or validation error) #}
                    {% if effect_specific_form and selected_effect_key %}
                        {% include '_effect_form_fields.html' %}
                    {% else %}
                        <p id="no-effect-selected-text">Select an effect to see its parameters.</p>
                    {% endif %}
                </div>
                
                <div class="form-row main-submit-row">
                    <div class="form-group submit-button-group">
                         {{ form.submit(class_="button", id="process-button") }}
                    </div>
                     <div class="form-group reset-button-group">
                        <button type="button" id="reset-button" class="button button-secondary">Reset Form</button>
                    </div>
                </div>
                <div id="global-error-message" class="error-message global-error" style="display:none;"></div>
            </form>
        </div>

        <div id="image-preview" style="display:none;" class="preview-container">
            <h2>Image Preview</h2>
            <div class="preview-container">
                <div class="preview-box" id="processed-container" style="display:none;">
                    <h3>Processed Image</h3>
                    <img id="processed-preview" src="" alt="Processed Image">
                    <div class="action-buttons">
                        <a id="download-link" href="" download>Download Processed Image</a>
                        <button id="use-processed-button" type="button">Use as Input Image</button>
                    </div>
                </div>
                <div class="preview-box">
                    <h3>Original Image</h3>
                    <img id="original-preview" src="" alt="Original Image">
                </div>
            </div>
        </div>
        
        <!-- Debug Info Section -->
        <div class="debug-info" id="debug-info">
            <h3>Debug Information</h3>
            <div id="debug-content"></div>
        </div>
    </div>
    
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        // This entire script block is new or heavily refactored.
        $(document).ready(function() {
            var selected_effect_key_from_server = {{ selected_effect_key|tojson if selected_effect_key is not none else 'null'|safe }};
            var initialEffectFromDropdown = $('#effect').val();

            function loadEffectFields(effectKey, isInitialLoad) {
                if (!effectKey) {
                    $('#effect-specific-fields-container').html('<p id="no-effect-selected-text">Select an effect to see its parameters.</p>');
                    return;
                }
                console.log("(Re)Loading fields for effect:", effectKey, "Initial Load Flag:", isInitialLoad);
                $('#effect-specific-fields-container').html('<p class="loading-text">Loading parameters for ' + effectKey.replace(/_/g, ' ') + '...</p>');

                $.ajax({
                    url: '/get-effect-form/' + effectKey,
                    type: 'GET',
                    dataType: 'json',
                    success: function(data) {
                        if (data.success) {
                            $('#effect-specific-fields-container').html(data.html);
                            setupConditionalFields(effectKey);
                            if (isInitialLoad && selected_effect_key_from_server && selected_effect_key_from_server !== $('#effect').val()) {
                                console.log('Syncing dropdown to server key:', selected_effect_key_from_server);
                                $('#effect').val(selected_effect_key_from_server);
                            }
                        } else {
                            $('#effect-specific-fields-container').html('<p class="error-message">Error loading parameters: ' + (data.error || 'Unknown error') + '</p>');
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error("Error loading effect fields:", status, error, xhr.responseText);
                        var errorDetail = xhr.responseJSON ? xhr.responseJSON.error : error;
                        $('#effect-specific-fields-container').html('<p class="error-message">Error loading parameters. Please try again. (' + errorDetail + ')</p>');
                    }
                });
            }
            
            var serverRenderedSpecificFields = $('#effect-specific-fields-container').children().not('#no-effect-selected-text, .loading-text').length > 0;
            console.log('selected_effect_key_from_server:', selected_effect_key_from_server, 'initialEffectFromDropdown:', initialEffectFromDropdown, 'serverRenderedSpecificFields:', serverRenderedSpecificFields);

            if (selected_effect_key_from_server) {
                if (!serverRenderedSpecificFields || selected_effect_key_from_server !== initialEffectFromDropdown) {
                    console.log('Case 1: Server key exists, but fields not rendered OR dropdown mismatch. Loading for server key.');
                    loadEffectFields(selected_effect_key_from_server, true); 
                } else { 
                    console.log('Case 2: Server key exists, fields rendered, dropdown matches. Setting up conditionals.');
                    if ($('#effect').val() !== selected_effect_key_from_server) { $('#effect').val(selected_effect_key_from_server); }
                    setupConditionalFields(selected_effect_key_from_server); 
                }
            } else { 
                if (initialEffectFromDropdown && !serverRenderedSpecificFields) {
                    console.log('Case 3: No server key, dropdown has value, fields not rendered. Loading for dropdown value.');
                    loadEffectFields(initialEffectFromDropdown, false); 
                } else if (!initialEffectFromDropdown && !serverRenderedSpecificFields) {
                    console.log('Case 4: No server key, no dropdown value, fields not rendered. Showing placeholder.');
                    $('#effect-specific-fields-container').html('<p id="no-effect-selected-text">Select an effect to see its parameters.</p>');
                } else if (serverRenderedSpecificFields && !initialEffectFromDropdown && !selected_effect_key_from_server){
                    // This case implies fields were rendered for some reason but no selection is active.
                    // This might happen if template renders default fields even when selected_effect_key is null.
                    // To be safe, clear them or set placeholder if the main #effect is also empty.
                    console.log('Case 5: Fields rendered, but no active selection. Clearing to placeholder if dropdown is empty.');
                    if(!$('#effect').val()){ // only clear if dropdown is also empty
                        $('#effect-specific-fields-container').html('<p id="no-effect-selected-text">Select an effect to see its parameters.</p>');
                    }
                }
            }

            $('#effect').on('change', function() {
                var selectedEffect = $(this).val();
                console.log("Effect dropdown changed to:", selectedEffect);
                selected_effect_key_from_server = selectedEffect; // Update global tracker
                if (selectedEffect) {
                    var currentUrl = new URL(window.location.href);
                    currentUrl.searchParams.set('effect', selectedEffect);
                    window.history.pushState({path:currentUrl.href}, '', currentUrl.href);
                } else {
                     var currentUrl = new URL(window.location.href);
                     currentUrl.searchParams.delete('effect');
                     window.history.pushState({path:currentUrl.href}, '', currentUrl.href);
                }
                loadEffectFields(selectedEffect, false);
            });

            function setupConditionalFields(effectKey) {
                console.log("Setting up conditional fields for:", effectKey);
                if (!effectKey) return;
                function getFieldGroupId(fieldId) { return '#form-group-' + effectKey + '-' + fieldId; }
                if (effectKey === 'color_channel') {
                    const manipType = $(getFieldGroupId('manipulation_type') + ' select');
                    const swapFields = $(getFieldGroupId('swap_choice'));
                    const invertFields = $(getFieldGroupId('invert_choice'));
                    const adjustFields = $(getFieldGroupId('adjust_choice') + ', ' + getFieldGroupId('intensity_factor'));
                    function toggle() { const val = manipType.val(); swapFields.toggle(val === 'swap'); invertFields.toggle(val === 'invert'); adjustFields.toggle(val === 'adjust'); }
                    manipType.off('change.conditionalColor').on('change.conditionalColor', toggle); toggle();
                } else if (effectKey === 'slice_offset') {
                    const offsetMode = $(getFieldGroupId('offset_mode') + ' select');
                    const frequencyField = $(getFieldGroupId('frequency'));
                    function toggle() { frequencyField.toggle(offsetMode.val() === 'sine'); }
                    offsetMode.off('change.conditionalSliceOffset').on('change.conditionalSliceOffset', toggle); toggle();
                } else if (effectKey === 'masked_merge') {
                    const maskTypeSelect = $(getFieldGroupId('mask_type') + ' select');
                    const commonFields = $(getFieldGroupId('mask_width') + ', ' + getFieldGroupId('mask_height'));
                    const stripedFields = $(getFieldGroupId('stripe_width') + ', ' + getFieldGroupId('stripe_angle'));
                    const linearGradientField = $(getFieldGroupId('gradient_direction'));
                    const perlinFields = $(getFieldGroupId('perlin_noise_scale') + ', ' + getFieldGroupId('perlin_threshold') + ', ' + getFieldGroupId('perlin_octaves'));
                    const voronoiField = $(getFieldGroupId('voronoi_num_cells'));
                    const concentricRectField = $(getFieldGroupId('rectangle_band_width'));
                    const concentricCircleFields = $(getFieldGroupId('circle_band_width') + ', ' + getFieldGroupId('circle_origin'));
                    const randomTriangleField = $(getFieldGroupId('triangle_size'));
                    function toggle() {
                        const type = maskTypeSelect.val();
                        [commonFields, stripedFields, linearGradientField, perlinFields, voronoiField, concentricRectField, concentricCircleFields, randomTriangleField].forEach(f => f.hide());
                        if (type === 'checkerboard' || type === 'random_checkerboard') commonFields.show();
                        else if (type === 'striped' || type === 'gradient_striped' || type === 'linear_gradient_striped') { stripedFields.show(); if (type === 'linear_gradient_striped') linearGradientField.show(); }
                        else if (type === 'perlin') perlinFields.show();
                        else if (type === 'voronoi') voronoiField.show();
                        else if (type === 'concentric_rectangles') concentricRectField.show();
                        else if (type === 'concentric_circles') concentricCircleFields.show();
                        else if (type === 'random_triangles') randomTriangleField.show();
                    }
                    maskTypeSelect.off('change.conditionalMaskedMerge').on('change.conditionalMaskedMerge', toggle); toggle();
                } else if (effectKey === 'ripple') {
                    const distortionTypeSelect = $(getFieldGroupId('distortion_type') + ' select');
                    const colorShiftFields = $(getFieldGroupId('color_r_factor') + ', ' + getFieldGroupId('color_g_factor') + ', ' + getFieldGroupId('color_b_factor'));
                    const pixelationFields = $(getFieldGroupId('pixelation_scale') + ', ' + getFieldGroupId('pixelation_magnitude'));
                    function toggle() { const type = distortionTypeSelect.val(); colorShiftFields.toggle(type === 'color_shift'); pixelationFields.toggle(type === 'pixelation'); }
                    distortionTypeSelect.off('change.conditionalRipple').on('change.conditionalRipple', toggle); toggle();
                }
            }

            $('#image-form').on('submit', function(e) {
                e.preventDefault();
                $('#global-error-message').hide().empty();
                $('.specific-field-error').remove(); 
                $('.form-group.has-error').removeClass('has-error');
                
                var formData = new FormData(this);
                var submitButton = $('#process-button'); 
                var originalButtonText = submitButton.val() || submitButton.text();
                submitButton.val('Processing...').text('Processing...').prop('disabled', true);

                $.ajax({
                    url: '/', 
                    type: 'POST',
                    data: formData,
                    dataType: 'json',
                    processData: false,
                    contentType: false,
                    headers: { 'X-CSRFToken': $('input[name="csrf_token"]').val() },
                    success: function(data) {
                        submitButton.val(originalButtonText).text(originalButtonText).prop('disabled', false);
                        if (data.success) {
                            $('#processed-image').attr('src', data.processed_url).show();
                            $('#download-link').attr('href', data.processed_url);
                            $('#replace-primary-link').data('new-image-url', data.processed_url);
                            $('#processed-container').show();
                            $('#image-preview').show(); 
                             if(data.was_resized) {
                                $('#resize-notification-text').text('Image was resized from ' + data.original_size + ' to ' + data.new_size + ' for performance.');
                                $('#resize-notification').fadeIn().css('display', 'block');
                            } else {
                                $('#resize-notification').fadeOut();
                            }
                        } else {
                            var errorMessage = data.error || "An unknown error occurred.";
                            if (data.form_errors) {
                                errorMessage = "Please correct the following errors:";
                                var currentEffectKeyForErrorDisplay = selected_effect_key_from_server || $('#effect').val();
                                $.each(data.form_errors, function(fieldName, errors) {
                                    var fieldIdPrefix = currentEffectKeyForErrorDisplay ? currentEffectKeyForErrorDisplay + '-' : '';
                                    var fieldGroup = $('#form-group-' + fieldIdPrefix + fieldName);
                                    if (!fieldGroup.length) { fieldGroup = $('#form-group-' + fieldName); } 
                                    if (!fieldGroup.length) { fieldGroup = $('[name="'+fieldName+'"]').closest('.form-group'); }

                                    if(fieldGroup.length){ //Only proceed if group found
                                        fieldGroup.addClass('has-error');
                                        var errorList = '<ul class="error-message specific-field-error">';
                                        $.each(errors, function(i, error) { errorList += '<li>' + error + '</li>'; });
                                        errorList += '</ul>';
                                        fieldGroup.append(errorList);
                                    } else { // Log if field group not found for an error
                                        console.warn("Could not find field group for error on field:", fieldName, "Tried prefix:", fieldIdPrefix);
                                        // Append to global if specific field not found
                                        if ($('#global-error-message').is(':empty')) { $('#global-error-message').text(errorMessage); }
                                        $('#global-error-message').append('<br/>Error for ' + fieldName + ': ' + errors.join(', ')).show();                                        
                                    }
                                });
                                if (!$('#global-error-message').is(':empty') && $('#global-error-message').text() !== errorMessage) { /* Keep specific errors */ } 
                                else { $('#global-error-message').text(errorMessage).show(); }

                            } else { // No form_errors, just a general error message
                                $('#global-error-message').text(errorMessage).show();
                            }
                        }
                    },
                    error: function(xhr, status, error) {
                        submitButton.val(originalButtonText).text(originalButtonText).prop('disabled', false);
                        var errorMsg = "Error processing image. Please try again.";
                        try {
                            var response = JSON.parse(xhr.responseText);
                            if (response && response.error) {
                                errorMsg = response.error;
                                if (response.form_errors) {
                                     errorMsg = "Please correct the following errors:";
                                     // Simplified error display for XHR errors, main logic is in success block
                                }
                            }
                        } catch (e) { /* Response was not JSON */ }
                        $('#global-error-message').text(errorMsg).show();
                        console.error("XHR Error:", error, xhr.status, xhr.responseText);
                    }
                });
            });

            $('#reset-button').on('click', function() {
                $('#image-form')[0].reset();
                $('#effect').val("").trigger('change'); // Trigger change to clear specific fields via loadEffectFields
                $('#original-preview').attr('src', '#').hide();
                $('#processed-image').attr('src', '#').hide();
                $('#processed-container').hide();
                $('#image-preview').hide();
                $('#global-error-message').hide().empty();
                $('.specific-field-error').remove();
                $('.form-group.has-error').removeClass('has-error');
                $('#resize-notification').hide();
                var currentUrl = new URL(window.location.href);
                currentUrl.searchParams.delete('effect');
                window.history.pushState({path:currentUrl.href}, '', currentUrl.href);
                selected_effect_key_from_server = null;
            });
            
            $('#replace-primary-link').on('click', function(e) {
                e.preventDefault();
                var newImageUrl = $(this).data('new-image-url');
                if (newImageUrl) {
                    fetch(newImageUrl)
                        .then(res => res.blob())
                        .then(blob => {
                            var filename = newImageUrl.substring(newImageUrl.lastIndexOf('/')+1);
                            var originalPart = filename.split('_').slice(0, -2).join('_') || "processed_image";
                            var extension = filename.split('.').pop() || "jpg";
                            var newFilename = originalPart + "_reprocessed." + extension;
                            var file = new File([blob], newFilename, { type: blob.type });
                            var dataTransfer = new DataTransfer(); dataTransfer.items.add(file);
                            $('#primary-image-input')[0].files = dataTransfer.files;
                            $('#primary-image-input').trigger('change'); // To trigger previewImage
                            $('html, body').animate({ scrollTop: 0 }, 'slow');
                            // alert("Processed image loaded as new primary image."); // Can be too intrusive
                            $('#global-error-message').removeClass('error-message').addClass('success-message').text('Processed image loaded as new primary.').show().delay(3000).fadeOut(function(){ $(this).removeClass('success-message').addClass('error-message'); });
                        })
                        .catch(error => {
                            console.error("Error fetching processed image for replace:", error);
                            $('#global-error-message').text('Could not load processed image as primary.').show();
                        });
                }
            });
        });

        function previewImage(event) {
            var file = event.target.files[0];
            if (file) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    $('#original-preview').attr('src', e.target.result).show();
                    $('#image-preview').show(); 
                    $('#processed-container').hide(); 
                    $('#processed-image').attr('src', '#');
                    $('#resize-notification').hide();
                };
                reader.readAsDataURL(file);
            } else {
                 $('#original-preview').attr('src', '#').hide();
            }
        }
    </script>
</body>
</html>