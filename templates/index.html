<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XWAVE XLITCH ART</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1a;
            --card-bg: #252525;
            --accent-color: #00c896;
            --text-color: #e0e0e0;
            --text-secondary: #a0a0a0;
            --border-color: #333;
            --input-bg: #333;
            --error-color: #ff5252;
            --success-color: #4caf50;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            max-width: 100%;
            overflow-x: hidden;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: var(--accent-color);
            font-size: 2.5rem;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            body {
                padding: 10px;
            }
        }
        
        .form-container {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            max-width: 100%;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-group {
            flex: 1 1 300px;
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .form-group {
                flex: 1 1 100%;
            }
            
            .form-row {
                flex-direction: column;
                gap: 10px;
            }
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-color);
            font-weight: 500;
        }
        
        .required-field::after {
            content: "";
            color: var(--accent-color);
        }
        
        input[type="text"],
        input[type="number"],
        input[type="file"],
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--input-bg);
            color: var(--text-color);
            font-size: 16px;
        }
        
        input[type="file"] {
            padding: 8px;
            cursor: pointer;
        }
        
        .chunk-size-inputs {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chunk-size-inputs input {
            flex: 1;
        }
        
        .chunk-size-inputs span {
            font-weight: bold;
            color: var(--text-secondary);
        }
        
        button {
            background-color: var(--accent-color);
            color: #fff;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background-color 0.2s;
            display: inline-block;
            text-align: center;
            margin-top: 10px;
        }
        
        button:hover {
            background-color: #00b084;
        }
        
        .effect-fields {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        
        .effect-fields h3 {
            margin-bottom: 15px;
            color: var(--accent-color);
        }
        
        .nested-fields {
            margin-top: 15px;
            margin-left: 15px;
            padding: 15px;
            border-left: 3px solid var(--accent-color);
            background-color: rgba(0, 200, 150, 0.05);
        }
        
        .help-text {
            display: block;
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 5px;
        }
        
        .error-message {
            color: var(--error-color);
            background-color: rgba(255, 82, 82, 0.1);
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .alert {
            padding: 12px 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .alert-info {
            color: #0288d1;
            background-color: rgba(2, 136, 209, 0.1);
            border: 1px solid rgba(2, 136, 209, 0.2);
        }
        
        .resize-notification {
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .global-error {
            margin-top: 10px;
        }
        
        .has-error input,
        .has-error select {
            border-color: var(--error-color);
        }
        
        #image-preview, #processed-container {
            margin-top: 30px;
            text-align: center;
        }
        
        .preview-container {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .preview-container h2 {
            margin-bottom: 15px;
            color: var(--accent-color);
        }
        
        .preview-image {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .action-buttons a, 
        .action-buttons button {
            padding: 10px 15px;
            background-color: var(--accent-color);
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 120px;
        }
        
        .action-buttons a:hover, 
        .action-buttons button:hover {
            background-color: #00b084;
            transform: translateY(-2px);
        }
        
        #loading {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--accent-color);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        #debug-info {
            margin-top: 30px;
            padding: 15px;
            background-color: var(--card-bg);
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            color: var(--text-secondary);
            white-space: pre-wrap;
            overflow-x: auto;
            display: none;
        }
        
        /* Mobile-specific styles */
        @media (max-width: 480px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .form-container, .preview-container {
                padding: 15px;
                border-radius: 6px;
            }
            
            button, .action-buttons a, .action-buttons button {
                width: 100%;
                padding: 12px 10px;
                font-size: 14px;
                min-width: unset;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            input[type="text"],
            input[type="number"],
            input[type="file"],
            select {
                font-size: 14px;
                padding: 8px;
            }
            
            .effect-fields h3 {
                font-size: 1.2rem;
            }
        }
        
        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
        }

        @media (max-width: 768px) {
            .form-container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <h1>XWAVE XLITCH ART</h1>
    <div class="form-container">
        <form method="POST" action="/" enctype="multipart/form-data" id="image-form">
            {{ form.hidden_tag() }}
            
            <div class="form-row">
                <div class="form-group">
                    <label class="required-field">{{ form.primary_image.label }}</label>
                    {{ form.primary_image(id="primary-image-input", required=True) }}
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.effect.label }}</label>
                    {{ form.effect(id="effect", required=True) }}
                </div>
            </div>
            
            <!-- Pixel Sort Chunk (Combined) -->
            <div id="pixel_sort_chunk_fields" class="effect-fields" style="display:none;">
                <h3>Pixel Sort Chunk</h3>
                <div class="alert alert-info">
                    <strong>About Pixel Sort Chunk:</strong> This effect sorts pixels within defined rectangular chunks based on various properties like brightness, hue, or color. Choose between horizontal, vertical, or diagonal sorting directions for different aesthetic results. Larger chunks create bold glitch patterns while smaller chunks produce more subtle texture effects.
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.sort_mode.label }}</label>
                    {{ form.sort_mode(id="sort_mode", required=True) }}
                    <span class="help-text">Choose the direction of pixel sorting within each chunk</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.sort_by.label }}</label>
                    {{ form.sort_by(required=True) }}
                    <span class="help-text">Property to sort pixels by</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.sort_order.label }}</label>
                    {{ form.sort_order(required=True) }}
                    <span class="help-text">Sort in ascending (low to high) or descending (high to low) order</span>
                </div>
                <div class="form-group">
                    <label class="required-field">Chunk Size</label>
                    <div class="chunk-size-inputs">
                        {{ form.chunk_width(required=True, placeholder="Width", value="48", min=8, max=2048, step=8) }}
                        <span>x</span>
                        {{ form.chunk_height(required=True, placeholder="Height", value="48", min=8, max=2048, step=8) }}
                    </div>
                    <span class="help-text">Values must be multiples of 8 (8-2048)</span>
                </div>
                <div id="diagonal_fields" class="sub-effect-fields" style="display:none;">
                    <div class="form-group">
                        <label class="required-field">{{ form.starting_corner.label }}</label>
                        {{ form.starting_corner(required=True) }}
                        <span class="help-text">Starting point for diagonal sorting</span>
                    </div>
                </div>
            </div>
            
            <!-- Full Frame Sorting -->
            <div id="full_frame_sort_fields" class="effect-fields" style="display:none;">
                <h3>Full Frame Sorting</h3>
                <div class="alert alert-info">
                    <strong>About Full Frame Sorting:</strong> This effect sorts all pixels across the entire image at once, creating smooth gradients or stark dividing lines. Unlike chunk-based sorting, this affects the entire image in one operation, resulting in dramatic transformations based on the property you choose to sort by.
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.full_frame_direction.label }}</label>
                    {{ form.full_frame_direction(required=True) }}
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.full_frame_sort_by.label }}</label>
                    {{ form.full_frame_sort_by(required=True) }}
                    <span class="help-text">Property to sort pixels by</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.full_frame_reverse.label }}</label>
                    {{ form.full_frame_reverse(required=True) }}
                </div>
            </div>
            
            <!-- Polar Sorting -->
            <div id="polar_sort_fields" class="effect-fields" style="display:none;">
                <h3>Polar Sorting</h3>
                <div class="alert alert-info">
                    <strong>About Polar Sorting:</strong> This effect sorts pixels based on their relationship to the center of the image, using either angle (around the center) or radius (distance from center). The result creates circular or radial patterns that highlight the natural symmetry or asymmetry in your image.
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.polar_chunk_size.label }}</label>
                    {{ form.polar_chunk_size(required=True, min=8, max=128, step=8, type="number") }}
                    <span class="help-text">Size of square chunks (8-128, multiples of 8)</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.polar_sort_by.label }}</label>
                    {{ form.polar_sort_by(required=True) }}
                    <span class="help-text">Sort by angle around center or distance from center</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.polar_reverse.label }}</label>
                    {{ form.polar_reverse(required=True) }}
                </div>
            </div>
            
            <!-- Perlin Noise Sorting -->
            <div id="perlin_noise_sort_fields" class="effect-fields" style="display:none;">
                <h3>Perlin Noise Sorting</h3>
                <div class="alert alert-info">
                    <strong>About Perlin Noise Sorting:</strong> This effect uses Perlin noise (smooth random gradients) to determine how to sort pixels in chunks. This creates organic, flowing distortions that follow the noise pattern. The noise scale determines the "turbulence" of the effect, creating wavy, dreamlike distortions in your image.
                </div>
                <div class="form-group">
                    <label class="required-field">Chunk Size</label>
                    <div class="chunk-size-inputs">
                        {{ form.perlin_chunk_width(required=True, placeholder="Width", value="128", min=8, max=1024, step=8) }}
                        <span>x</span>
                        {{ form.perlin_chunk_height(required=True, placeholder="Height", value="1024", min=8, max=1024, step=8) }}
                    </div>
                    <span class="help-text">Values must be multiples of 8 (8-1024). Use large values for full rows/columns.</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.perlin_noise_scale.label }}</label>
                    {{ form.perlin_noise_scale(required=True, min=0.001, max=0.1, step=0.001, type="number", value="0.008") }}
                    <span class="help-text">Scale of noise (0.001-0.1, higher = more detailed)</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.perlin_seed.label }}</label>
                    {{ form.perlin_seed(required=True, min=1, max=9999, type="number", value="420") }}
                    <span class="help-text">Seed for noise pattern (1-9999, same seed = same pattern)</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.perlin_direction.label }}</label>
                    {{ form.perlin_direction(required=True) }}
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.perlin_reverse.label }}</label>
                    {{ form.perlin_reverse(required=True) }}
                </div>
            </div>
            
            <!-- Perlin Full Frame -->
            <div id="perlin_full_frame_fields" class="effect-fields" style="display:none;">
                <h3>Perlin Full Frame Sorting</h3>
                <div class="alert alert-info">
                    <strong>About Perlin Full Frame Sorting:</strong> This effect combines Perlin noise with full-frame sorting for extraordinary transformations. The noise pattern determines the sort order across the entire image at once, creating fluid, dreamlike distortions that completely reimagine your image while maintaining some semblance of the original structure.
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.perlin_full_frame_noise_scale.label }}</label>
                    {{ form.perlin_full_frame_noise_scale(required=True, min=0.001, max=0.1, step=0.001, type="number", value="0.005") }}
                    <span class="help-text">Scale of noise (0.001-0.1, higher = more detailed)</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.perlin_full_frame_seed.label }}</label>
                    {{ form.perlin_full_frame_seed(required=True, min=1, max=9999, type="number", value="69") }}
                    <span class="help-text">Seed for noise pattern (1-9999, same seed = same pattern)</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.perlin_full_frame_sort_by.label }}</label>
                    {{ form.perlin_full_frame_sort_by(required=True) }}
                    <span class="help-text">Property to sort pixels by</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.perlin_full_frame_reverse.label }}</label>
                    {{ form.perlin_full_frame_reverse(required=True) }}
                </div>
            </div>
            
            <!-- Pixelate -->
            <div id="pixelate_fields" class="effect-fields" style="display:none;">
                <h3>Pixelate</h3>
                <div class="alert alert-info">
                    <strong>About Pixelate:</strong> This effect reduces the resolution of your image into larger blocks of color, but with advanced control over how those blocks are colored. Instead of simple downsampling, you can choose to represent each block based on different image attributes like hue or brightness, and control the intensity via the number of color bins.
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="required-field">{{ form.pixelate_width.label }}</label>
                        {{ form.pixelate_width(required=True, min=2, max=64) }}
                        <span class="help-text">Width of each pixel block (2-64)</span>
                    </div>
                    <div class="form-group">
                        <label class="required-field">{{ form.pixelate_height.label }}</label>
                        {{ form.pixelate_height(required=True, min=2, max=64) }}
                        <span class="help-text">Height of each pixel block (2-64)</span>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="required-field">{{ form.pixelate_attribute.label }}</label>
                        {{ form.pixelate_attribute(required=True) }}
                        <span class="help-text">Attribute to use for determining pixel color</span>
                    </div>
                    <div class="form-group">
                        <label class="required-field">{{ form.pixelate_bins.label }}</label>
                        {{ form.pixelate_bins(required=True, min=10, max=1000) }}
                        <span class="help-text">Number of bins for quantizing attribute values (10-1000)</span>
                    </div>
                </div>
            </div>
            
            <!-- Concentric Shapes -->
            <div id="concentric_shapes_fields" class="effect-fields" style="display:none;">
                <h3>Concentric Shapes</h3>
                <div class="alert alert-info">
                    <strong>About Concentric Shapes:</strong> This effect overlays geometric patterns of concentric shapes (circles, squares, hexagons, or triangles) onto your image. Starting from random seed points, it draws expanding shapes with customizable properties like thickness, spacing, and color. The result creates an abstract geometric overlay that interacts with your original image.
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="required-field">{{ form.concentric_num_points.label }}</label>
                        {{ form.concentric_num_points(required=True, min=1, max=100) }}
                        <span class="help-text">Number of random points to select (1-100)</span>
                    </div>
                    <div class="form-group">
                        <label class="required-field">{{ form.shape_type.label }}</label>
                        {{ form.shape_type(required=True) }}
                        <span class="help-text">Type of shape to draw</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.concentric_thickness.label }}</label>
                    {{ form.concentric_thickness(required=True, min=1, max=10) }}
                    <span class="help-text">Thickness of each shape's outline (1-10)</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.spacing.label }}</label>
                    {{ form.spacing(required=True, min=1, max=50) }}
                    <span class="help-text">Spacing between shapes (1-50)</span>
                </div>
                <div class="form-group">
                    <label>{{ form.rotation_angle.label }}</label>
                    {{ form.rotation_angle(min=0, max=360) }}
                    <span class="help-text">Rotation angle for each subsequent shape (0-360)</span>
                </div>
                <div class="form-group">
                    <label>{{ form.darken_step.label }}</label>
                    {{ form.darken_step(min=0, max=255) }}
                    <span class="help-text">Amount to darken each subsequent shape (0-255)</span>
                </div>
                <div class="form-group">
                    <label>{{ form.color_shift.label }}</label>
                    {{ form.color_shift(min=0, max=360) }}
                    <span class="help-text">Amount to shift the hue for each shape (0-360)</span>
                </div>
            </div>
            
            <!-- Color Channel Manipulation -->
            <div id="color_channel_fields" class="effect-fields" style="display:none;">
                <h3>Color Channel Manipulation</h3>
                <div class="alert alert-info">
                    <strong>About Color Channel Manipulation:</strong> This effect lets you alter the individual RGB color channels of your image in various ways. You can swap channels (e.g., red becomes green), invert specific channels, adjust channel intensity, or create a full negative. These operations create surreal color shifts while preserving the original image structure.
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.manipulation_type.label }}</label>
                    {{ form.manipulation_type(id="manipulation_type", required=True) }}
                </div>
                <div id="swap_fields" class="effect-fields" style="display:none;">
                    <div class="form-group">
                        <label class="required-field">{{ form.swap_choice.label }}</label>
                        {{ form.swap_choice(required=True) }}
                    </div>
                </div>
                <div id="invert_fields" class="effect-fields" style="display:none;">
                    <div class="form-group">
                        <label class="required-field">{{ form.invert_choice.label }}</label>
                        {{ form.invert_choice(required=True) }}
                    </div>
                </div>
                <div id="negative_fields" class="effect-fields" style="display:none;">
                    <div class="form-group">
                        <span class="help-text">Creates a negative of the entire image by inverting all color channels.</span>
                    </div>
                </div>
                <div id="adjust_fields" class="effect-fields" style="display:none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="required-field">{{ form.adjust_choice.label }}</label>
                            {{ form.adjust_choice(required=True) }}
                        </div>
                        <div class="form-group">
                            <label class="required-field">{{ form.intensity_factor.label }}</label>
                            {{ form.intensity_factor(required=True, placeholder="1.5", value="1.5") }}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Double Expose -->
            <div id="double_expose_fields" class="effect-fields" style="display:none;">
                <h3>Double Expose</h3>
                <div class="alert alert-info">
                    <strong>About Double Expose:</strong> This effect combines two images using different blending modes, similar to traditional double exposure in film photography. Each blend mode creates a unique interaction between the images - from simple transparency blending to more complex operations like screen, multiply, or difference, which can dramatically alter colors and tones.
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.secondary_image.label }}</label>
                    {{ form.secondary_image(id="secondary-image-input", required=True) }}
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="required-field">{{ form.blend_mode.label }}</label>
                        {{ form.blend_mode(required=True) }}
                        <span class="help-text">Different blend modes create different visual effects</span>
                    </div>
                    <div class="form-group">
                        <label class="required-field">{{ form.opacity.label }}</label>
                        {{ form.opacity(required=True, min=0.1, max=1.0, step=0.1, type="number") }}
                        <span class="help-text">Strength of the blend (0.1-1.0)</span>
                    </div>
                </div>
            </div>
            
            <!-- Pixel Drift -->
            <div id="pixel_drift_fields" class="effect-fields" style="display:none;">
                <h3>Pixel Drift</h3>
                <div class="alert alert-info">
                    <strong>About Pixel Drift:</strong> This effect shifts rows or columns of pixels in alternating patterns, creating a wave-like drifting or rippling effect. By controlling direction, number of bands, and intensity, you can create anything from subtle vibrations to dramatic distortions that make your image appear to be in motion.
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.drift_direction.label }}</label>
                    {{ form.drift_direction(required=True) }}
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.drift_bands.label }}</label>
                    {{ form.drift_bands(required=True, min=8, max=48, step=8, type="number") }}
                    <span class="help-text">Must be a multiple of 8 (8-48)</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.drift_intensity.label }}</label>
                    {{ form.drift_intensity(required=True, min=0.1, max=10, step=0.1, type="number") }}
                    <span class="help-text">Higher values = more extreme drift (0.1-10)</span>
                </div>
            </div>
            
            <!-- Spiral Sort 2 -->
            <div id="spiral_sort_2_fields" class="effect-fields" style="display:none;">
                <h3>Spiral Sort 2</h3>
                <div class="alert alert-info">
                    <strong>About Spiral Sort 2:</strong> An advanced version of Spiral Sort, this effect offers more sorting options and control. Instead of just brightness, you can sort the spiral chunks by various attributes like hue, saturation, or individual color channels. This provides more creative control and diverse spiral arrangements for different visual effects.
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.spiral2_chunk_size.label }}</label>
                    {{ form.spiral2_chunk_size(required=True, min=8, max=128, step=8, type="number") }}
                    <span class="help-text">Size of square chunks (8-128, multiples of 8)</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.spiral2_sort_by.label }}</label>
                    {{ form.spiral2_sort_by(required=True) }}
                    <span class="help-text">Property to sort pixels by</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.spiral2_reverse.label }}</label>
                    {{ form.spiral2_reverse(required=True) }}
                </div>
            </div>
            
            <!-- Bit Manipulation -->
            <div id="bit_manipulation_fields" class="effect-fields" style="display:none;">
                <h3>Bit Manipulation</h3>
                <div class="alert alert-info">
                    <strong>About Bit Manipulation:</strong> This effect directly manipulates the binary data of your image, randomly flipping bits to create digital corruption artifacts. The result mimics data corruption or compression glitches, producing unpredictable but fascinating visual distortions that include color shifts, pixelation, and partial image scrambling.
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.bit_chunk_size.label }}</label>
                    {{ form.bit_chunk_size(required=True, min=8, max=128, step=8, type="number") }}
                    <span class="help-text">Size of square chunks (8-128, multiples of 8)</span>
                </div>
            </div>
            
            <!-- Data Mosh Blocks -->
            <div id="data_mosh_blocks_fields" class="effect-fields" style="display:none;">
                <h3>Data Mosh Blocks</h3>
                <div class="alert alert-info">
                    <strong>About Data Mosh Blocks:</strong> This effect simulates the "datamoshing" technique by manipulating rectangular blocks of pixels. It can swap blocks, invert colors, shift color channels, and flip blocks horizontally or vertically. The result mimics compression artifacts found in corrupted video files, creating a disjointed collage effect from your original image.
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.data_mosh_operations.label }}</label>
                    {{ form.data_mosh_operations(required=True, min=1, max=256, type="number") }}
                    <span class="help-text">Number of operations to perform (1-256)</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.data_mosh_block_size.label }}</label>
                    {{ form.data_mosh_block_size(required=True, min=1, max=500, type="number") }}
                    <span class="help-text">Maximum size for block width and height (1-500)</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.data_mosh_movement.label }}</label>
                    {{ form.data_mosh_movement(required=True) }}
                    <span class="help-text">How blocks should be manipulated</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.data_mosh_color_swap.label }}</label>
                    {{ form.data_mosh_color_swap(required=True) }}
                    <span class="help-text">Control color channel swapping</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.data_mosh_invert.label }}</label>
                    {{ form.data_mosh_invert(required=True) }}
                    <span class="help-text">Control color inversion</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.data_mosh_shift.label }}</label>
                    {{ form.data_mosh_shift(required=True) }}
                    <span class="help-text">Control channel value shifting</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.data_mosh_flip.label }}</label>
                    {{ form.data_mosh_flip(required=True) }}
                    <span class="help-text">Control block flipping</span>
                </div>
                <div class="form-group">
                    <label>{{ form.data_mosh_seed.label }}</label>
                    {{ form.data_mosh_seed(min=0, type="number") }}
                    <span class="help-text">Optional: Set for reproducible results</span>
                </div>
            </div>
            
            <!-- Color Shift Expansion -->
            <div id="color_shift_expansion_fields" class="effect-fields" style="display:none;">
                <h3>Color Shift Expansion</h3>
                <div class="alert alert-info">
                    <strong>About Color Shift Expansion:</strong> This effect creates expanding regions of color shifts from random seed points. Colors radiate outward in patterns, creating a psychedelic or heatmap-like effect. You can control the pattern type, color themes, and expansion style to create unique flowing color transformations that partially preserve your original image.
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.color_shift_num_points.label }}</label>
                    {{ form.color_shift_num_points(required=True, min=1, max=100, type="number") }}
                    <span class="help-text">Number of random seed points (1-100)</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.color_shift_amount.label }}</label>
                    {{ form.color_shift_amount(required=True, min=1, max=10, type="number") }}
                    <span class="help-text">Intensity of color effect (1-10, higher = more dramatic)</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.expansion_type.label }}</label>
                    {{ form.expansion_type(required=True) }}
                    <span class="help-text">How the color shift expands from seed points</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.pattern_type.label }}</label>
                    {{ form.pattern_type(required=True) }}
                    <span class="help-text">Pattern for distributing seed points</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.color_theme.label }}</label>
                    {{ form.color_theme(required=True) }}
                    <span class="help-text">Color palette to use for the effect</span>
                </div>
                <div class="form-group">
                    <label>{{ form.saturation_boost.label }}</label>
                    {{ form.saturation_boost(min=0.0, max=1.0, step=0.1, type="number") }}
                    <span class="help-text">Increase color saturation (0.0-1.0)</span>
                </div>
                <div class="form-group">
                    <label>{{ form.value_boost.label }}</label>
                    {{ form.value_boost(min=0.0, max=1.0, step=0.1, type="number") }}
                    <span class="help-text">Increase brightness (0.0-1.0)</span>
                </div>
                <div class="form-group">
                    <label>{{ form.decay_factor.label }}</label>
                    {{ form.decay_factor(min=0.0, max=1.0, step=0.1, type="number") }}
                    <span class="help-text">Controls effect intensity falloff from seed points (0=uniform, 1=concentrated)</span>
                </div>
            </div>
            
            <!-- Perlin Displacement -->
            <div id="perlin_displacement_fields" class="effect-fields" style="display:none;">
                <h3>Perlin Displacement</h3>
                <div class="alert alert-info">
                    <strong>About Perlin Displacement:</strong> This effect warps your image by shifting pixels according to a Perlin noise pattern. The result looks like your image is reflected in rippling water or a funhouse mirror. The noise pattern creates organically flowing distortions rather than mechanical or uniform warping, preserving the original image content in a dreamlike state.
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.perlin_displacement_scale.label }}</label>
                    {{ form.perlin_displacement_scale(required=True, min=10, max=500, type="number") }}
                    <span class="help-text">Scale of the noise (10-500, higher = smoother distortion)</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.perlin_displacement_intensity.label }}</label>
                    {{ form.perlin_displacement_intensity(required=True, min=1, max=100, type="number") }}
                    <span class="help-text">Maximum pixel displacement (1-100, higher = more extreme warping)</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.perlin_displacement_octaves.label }}</label>
                    {{ form.perlin_displacement_octaves(required=True, min=1, max=10, type="number") }}
                    <span class="help-text">Number of noise layers (1-10, higher = more detail)</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.perlin_displacement_persistence.label }}</label>
                    {{ form.perlin_displacement_persistence(required=True, min=0.1, max=1.0, step=0.1, type="number") }}
                    <span class="help-text">Amplitude of each octave (0.1-1.0)</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.perlin_displacement_lacunarity.label }}</label>
                    {{ form.perlin_displacement_lacunarity(required=True, min=1.0, max=4.0, step=0.1, type="number") }}
                    <span class="help-text">Frequency of each octave (1.0-4.0)</span>
                </div>
            </div>
            
            <!-- Voronoi Pixel Sort -->
            <div id="voronoi_sort_fields" class="effect-fields" style="display:none;">
                <h3>Voronoi Pixel Sort</h3>
                <div class="alert alert-info">
                    <strong>About Voronoi Pixel Sort:</strong> This effect divides your image into Voronoi cells (organic-looking regions around seed points) and sorts pixels within each cell. The result creates a cellular, crystalline structure that follows the natural Voronoi pattern. By controlling sorting direction and orientation, you can create flowing lines within each cell that follow various patterns.
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.voronoi_num_cells.label }}</label>
                    {{ form.voronoi_num_cells(required=True, min=10, max=1000, type="number") }}
                    <span class="help-text">Number of Voronoi cells (10-1000)</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.voronoi_size_variation.label }}</label>
                    {{ form.voronoi_size_variation(required=True, min=0.0, max=1.0, step=0.1, type="number") }}
                    <span class="help-text">Variation in cell sizes (0.0-1.0, higher = more random sizes)</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.voronoi_sort_by.label }}</label>
                    {{ form.voronoi_sort_by(required=True) }}
                    <span class="help-text">Property to sort pixels by within each cell</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.voronoi_sort_order.label }}</label>
                    {{ form.voronoi_sort_order(required=True) }}
                    <span class="help-text">Angular ordering around the cell center</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.voronoi_orientation.label }}</label>
                    {{ form.voronoi_orientation(required=True) }}
                    <span class="help-text">Direction of sorting lines within each cell</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.voronoi_start_position.label }}</label>
                    {{ form.voronoi_start_position(required=True) }}
                    <span class="help-text">Starting position for pixel sorting within each cell</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.voronoi_seed.label }}</label>
                    {{ form.voronoi_seed(required=True, min=1, max=9999, type="number") }}
                    <span class="help-text">Seed for cell generation (1-9999, same seed = same pattern)</span>
                </div>
            </div>
            
            <!-- RGB Channel Shift -->
            <div id="channel_shift_fields" class="effect-fields" style="display:none;">
                <h3>RGB Channel Shift</h3>
                <div class="alert alert-info">
                    <strong>About RGB Channel Shift:</strong> This effect physically separates the RGB color channels of your image, creating a chromatic aberration effect similar to misaligned color prints or 3D anaglyph images. You can either shift channels apart (like a color fringing effect) or mirror them in different directions for more dramatic transformations.
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.channel_mode.label }}</label>
                    {{ form.channel_mode(required=True, id="channel_mode") }}
                    <span class="help-text">Choose between shifting channels apart or mirroring them</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.channel_shift_center.label }}</label>
                    {{ form.channel_shift_center(required=True) }}
                    <span class="help-text" id="center_channel_help">Channel that stays centered/unchanged (others will be processed)</span>
                </div>
                
                <!-- Shift-specific fields -->
                <div id="shift_mode_fields">
                    <div class="form-group">
                        <label class="required-field">{{ form.channel_shift_amount.label }}</label>
                        {{ form.channel_shift_amount(required=True, min=1, max=500, type="number") }}
                        <span class="help-text">Number of pixels to shift non-centered channels (1-500)</span>
                    </div>
                    <div class="form-group">
                        <label class="required-field">{{ form.channel_shift_direction.label }}</label>
                        {{ form.channel_shift_direction(required=True) }}
                        <span class="help-text">Direction to shift the channels</span>
                    </div>
                </div>
                
                <!-- Mirror-specific message -->
                <div id="mirror_mode_info" style="display:none;">
                    <div class="form-group">
                        <p class="help-text">In mirror mode, one channel remains unchanged while the other two are mirrored - one horizontally and one vertically.</p>
                        <p class="help-text">No additional settings needed for mirror mode.</p>
                    </div>
                </div>
            </div>
            
            <!-- JPEG Artifacts -->
            <div id="jpeg_artifacts_fields" class="effect-fields" style="display:none;">
                <h3>JPEG Artifacts</h3>
                <div class="alert alert-info">
                    <strong>About JPEG Artifacts:</strong> This effect simulates the compression artifacts that appear in highly compressed JPEG images. It creates blocky patterns, color banding, and edge ringing that are characteristic of low-quality JPEGs. The intensity control lets you determine how severely degraded the image becomes.
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.jpeg_intensity.label }}</label>
                    {{ form.jpeg_intensity(required=True, min=0.0, max=1.0, step=0.01, type="number") }}
                    <span class="help-text">Intensity of JPEG degradation (0.0-1.0, higher = more artifacts)</span>
                </div>
            </div>
            
            <!-- Pixel Scatter -->
            <div id="pixel_scatter_fields" class="effect-fields" style="display:none;">
                <h3>Pixel Scatter</h3>
                <div class="alert alert-info">
                    <strong>About Pixel Scatter:</strong> This effect identifies pixels in a specific range (e.g., certain brightness or hue values) and randomly scatters them horizontally or vertically. This creates streak-like artifacts that selectively affect only portions of your image matching your criteria, resulting in a unique distressed or particle-like effect.
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.scatter_direction.label }}</label>
                    {{ form.scatter_direction(required=True) }}
                    <span class="help-text">Direction to scatter pixels within rows or columns</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.scatter_select_by.label }}</label>
                    {{ form.scatter_select_by(required=True) }}
                    <span class="help-text">Criterion for selecting which pixels to scatter</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.scatter_min_value.label }}</label>
                    {{ form.scatter_min_value(required=True, min=0, max=360, step=1, type="number") }}
                    <span class="help-text">Minimum value for pixel selection (0-360 for hue, 0-255 for brightness)</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.scatter_max_value.label }}</label>
                    {{ form.scatter_max_value(required=True, min=0, max=360, step=1, type="number") }}
                    <span class="help-text">Maximum value for pixel selection (0-360 for hue, 0-255 for brightness)</span>
                </div>
            </div>
            
            <!-- Databending fields -->
            <div id="databend_fields" class="effect-fields" style="display: none;">
                <h3>Databending Settings</h3>
                <div class="alert alert-info">
                    <strong>About Databending:</strong> This effect simulates binary data corruption by applying various glitch-like transformations to the image. 
                    It applies pixel shifts, channel mixing, block repeats, XOR operations, and other effects randomized by the seed value.
                    Experiment with different intensity values and seeds to create unique glitches!
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="databend-intensity">Databend Intensity</label>
                        <input type="number" id="databend-intensity" name="databend_intensity" min="0.1" max="1.0" step="0.1" value="0.1">
                        <span class="help-text">Controls the number and strength of glitch effects (0.1-1.0). Start low for subtle effects.</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="databend-preserve-header">Preserve Header</label>
                        <select id="databend-preserve-header" name="databend_preserve_header">
                            <option value="true">Yes (Protect Top Area)</option>
                            <option value="false">No (Glitch Everything)</option>
                        </select>
                        <span class="help-text">When enabled, protects the top 10% of the image from glitching to preserve key visual elements.</span>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="databend-seed">Random Seed</label>
                        <input type="number" id="databend-seed" name="databend_seed" min="1" max="9999" value="42">
                        <span class="help-text">Controls the randomization of glitch effects. Different seeds create completely different patterns.</span>
                    </div>
                </div>
            </div>
            
            <!-- Histogram Glitch fields -->
            <div id="histogram_glitch_fields" class="effect-fields" style="display: none;">
                <h3>Histogram Glitch Settings</h3>
                <div class="alert alert-info">
                    <strong>About Histogram Glitch:</strong> This effect applies different mathematical transformations to each color channel, creating solarization and unique color shifts. 
                    Experiment with different combinations of transformation modes for interesting results.
                </div>
                
                <!-- Channel Treatments -->
                <h4>Channel Transformations</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label>{{ form.hist_r_mode.label }}</label>
                        {{ form.hist_r_mode }}
                        <span class="help-text">Mathematical transformation for the red channel</span>
                    </div>
                    <div class="form-group">
                        <label>{{ form.hist_g_mode.label }}</label>
                        {{ form.hist_g_mode }}
                        <span class="help-text">Mathematical transformation for the green channel</span>
                    </div>
                    <div class="form-group">
                        <label>{{ form.hist_b_mode.label }}</label>
                        {{ form.hist_b_mode }}
                        <span class="help-text">Mathematical transformation for the blue channel</span>
                    </div>
                </div>
                
                <!-- Solarize Parameters -->
                <h4>Solarization Parameters</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label>{{ form.hist_r_freq.label }}</label>
                        {{ form.hist_r_freq(min=0.1, max=10.0, step=0.1, type="number") }}
                        <span class="help-text">Wave frequency for red solarization</span>
                    </div>
                    <div class="form-group">
                        <label>{{ form.hist_r_phase.label }}</label>
                        {{ form.hist_r_phase(min=0.0, max=6.28, step=0.1, type="number") }}
                        <span class="help-text">Wave phase shift for red solarization</span>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>{{ form.hist_g_freq.label }}</label>
                        {{ form.hist_g_freq(min=0.1, max=10.0, step=0.1, type="number") }}
                        <span class="help-text">Wave frequency for green solarization</span>
                    </div>
                    <div class="form-group">
                        <label>{{ form.hist_g_phase.label }}</label>
                        {{ form.hist_g_phase(min=0.0, max=6.28, step=0.1, type="number") }}
                        <span class="help-text">Wave phase shift for green solarization</span>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>{{ form.hist_b_freq.label }}</label>
                        {{ form.hist_b_freq(min=0.1, max=10.0, step=0.1, type="number") }}
                        <span class="help-text">Wave frequency for blue solarization</span>
                    </div>
                    <div class="form-group">
                        <label>{{ form.hist_b_phase.label }}</label>
                        {{ form.hist_b_phase(min=0.0, max=6.28, step=0.1, type="number") }}
                        <span class="help-text">Wave phase shift for blue solarization</span>
                    </div>
                </div>
                
                <!-- Gamma Parameter -->
                <h4>Gamma Parameter</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label>{{ form.hist_gamma.label }}</label>
                        {{ form.hist_gamma(min=0.1, max=3.0, step=0.1, type="number") }}
                        <span class="help-text">Gamma value for gamma transformation (0.1-3.0)</span>
                    </div>
                </div>
            </div>
            
            <!-- Ripple Effect fields -->
            <div id="ripple_fields" class="effect-fields" style="display: none;">
                <h3>Ripple Effect Settings</h3>
                <div class="alert alert-info">
                    <strong>About Ripple Effect:</strong> This effect simulates water droplets on the image surface, creating ripple distortions. 
                    You can control the number of droplets, their intensity, and apply additional distortion effects like color shifting or pixelation for more dramatic results.
                </div>
                
                <!-- Basic Ripple Parameters -->
                <h4>Ripple Parameters</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label>{{ form.ripple_num_droplets.label }}</label>
                        {{ form.ripple_num_droplets(min=1, max=20, type="number") }}
                        <span class="help-text">Number of ripple centers (1-20)</span>
                    </div>
                    <div class="form-group">
                        <label>{{ form.ripple_amplitude.label }}</label>
                        {{ form.ripple_amplitude(min=1.0, max=50.0, step=1.0, type="number") }}
                        <span class="help-text">Strength of the ripple effect (1.0-50.0)</span>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>{{ form.ripple_frequency.label }}</label>
                        {{ form.ripple_frequency(min=0.01, max=1.0, step=0.01, type="number") }}
                        <span class="help-text">Frequency of ripple waves (0.01-1.0)</span>
                    </div>
                    <div class="form-group">
                        <label>{{ form.ripple_decay.label }}</label>
                        {{ form.ripple_decay(min=0.001, max=0.1, step=0.001, type="number") }}
                        <span class="help-text">How quickly ripples fade with distance (0.001-0.1)</span>
                    </div>
                </div>
                
                <!-- Distortion Type Selection -->
                <h4>Distortion Options</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label>{{ form.ripple_distortion_type.label }}</label>
                        {{ form.ripple_distortion_type(id="ripple_distortion_type") }}
                        <span class="help-text">Type of additional distortion to apply</span>
                    </div>
                </div>
                
                <!-- Color Shift Parameters -->
                <div id="ripple_color_shift_fields" class="nested-fields">
                    <h4>Color Shift Factors</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>{{ form.ripple_color_r.label }}</label>
                            {{ form.ripple_color_r(min=0.5, max=1.5, step=0.1, type="number") }}
                            <span class="help-text">Red channel displacement factor (0.5-1.5)</span>
                        </div>
                        <div class="form-group">
                            <label>{{ form.ripple_color_g.label }}</label>
                            {{ form.ripple_color_g(min=0.5, max=1.5, step=0.1, type="number") }}
                            <span class="help-text">Green channel displacement factor (0.5-1.5)</span>
                        </div>
                        <div class="form-group">
                            <label>{{ form.ripple_color_b.label }}</label>
                            {{ form.ripple_color_b(min=0.5, max=1.5, step=0.1, type="number") }}
                            <span class="help-text">Blue channel displacement factor (0.5-1.5)</span>
                        </div>
                    </div>
                </div>
                
                <!-- Pixelation Parameters -->
                <div id="ripple_pixelation_fields" class="nested-fields" style="display: none;">
                    <h4>Pixelation Parameters</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>{{ form.ripple_pixelation_scale.label }}</label>
                            {{ form.ripple_pixelation_scale(min=2, max=20, type="number") }}
                            <span class="help-text">Size of pixels (2-20, higher = larger pixels)</span>
                        </div>
                        <div class="form-group">
                            <label>{{ form.ripple_pixelation_max_mag.label }}</label>
                            {{ form.ripple_pixelation_max_mag(min=1.0, max=20.0, step=0.5, type="number") }}
                            <span class="help-text">Maximum magnitude for pixelation blend (1.0-20.0)</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Masked Merge -->
            <div id="masked_merge_fields" class="effect-fields" style="display: none;">
                <h3>Masked Merge</h3>
                <div class="alert alert-info">
                    <strong>About Masked Merge:</strong> This effect merges two images using a mask pattern that selectively shows parts of each image. Choose between checkerboard, striped, or Perlin noise patterns and adjust the settings to create different visual effects.
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.masked_merge_secondary.label }}</label>
                    {{ form.masked_merge_secondary(id="masked-merge-secondary-input", required=True) }}
                    <span class="help-text">The secondary image to merge with the primary image</span>
                </div>
                <div class="form-group">
                    <label class="required-field">{{ form.mask_type.label }}</label>
                    {{ form.mask_type(id="mask_type", required=True) }}
                    <span class="help-text">The type of mask pattern to use for merging</span>
                </div>
                
                <!-- Checkerboard-specific fields -->
                <div id="checkerboard_fields" class="nested-fields">
                    <div class="form-group">
                        <label class="required-field">{{ form.mask_width.label }}</label>
                        {{ form.mask_width(min=8, max=512, type="number", required=True) }}
                        <span class="help-text">Width of each cell in the checkerboard pattern (pixels)</span>
                    </div>
                    <div class="form-group">
                        <label class="required-field">{{ form.mask_height.label }}</label>
                        {{ form.mask_height(min=8, max=512, type="number", required=True) }}
                        <span class="help-text">Height of each cell in the checkerboard pattern (pixels)</span>
                    </div>
                </div>
                
                <!-- Random checkerboard seed field -->
                <div class="form-group" id="mask_random_seed_field" style="display: none;">
                    <label>{{ form.mask_random_seed.label }}</label>
                    {{ form.mask_random_seed(min=1, max=9999, type="number") }}
                    <span class="help-text">Seed for random pattern generation (same seed = same pattern)</span>
                </div>
                
                <!-- Striped-specific fields -->
                <div id="striped_fields" class="nested-fields" style="display: none;">
                    <div class="form-group">
                        <label class="required-field">{{ form.stripe_width.label }}</label>
                        {{ form.stripe_width(min=1, max=200, type="number", required=True) }}
                        <span class="help-text">Width of each stripe in pixels</span>
                    </div>
                    <div class="form-group">
                        <label class="required-field">{{ form.stripe_angle.label }}</label>
                        {{ form.stripe_angle(min=0, max=180, type="number", required=True) }}
                        <span class="help-text">Angle of the stripes in degrees (0-180)</span>
                    </div>
                </div>
                
                <!-- Gradient description for gradient stripes -->
                <div id="gradient_description" class="nested-fields" style="display: none;">
                    <div class="form-group">
                        <div class="alert alert-info">
                            <strong>About Gradient Striped:</strong> Creates smooth transitions between images using sine wave gradients rather than hard edges. The stripe width controls the frequency of these transitions.
                        </div>
                    </div>
                </div>
                
                <!-- Perlin noise fields -->
                <div id="perlin_fields" class="nested-fields" style="display: none;">
                    <div class="form-group">
                        <div class="alert alert-info">
                            <strong>About Perlin Noise:</strong> Creates natural, cloud-like transition boundaries between the two images rather than a simple crossfade, resulting in an organic-looking composite image.
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="required-field">{{ form.perlin_noise_scale.label }}</label>
                        {{ form.perlin_noise_scale(required=True, min=0.001, max=0.1, step=0.001, type="number") }}
                        <span class="help-text">Scale of noise (0.001-0.1, higher = more detailed pattern)</span>
                    </div>
                    <div class="form-group">
                        <label class="required-field">{{ form.perlin_threshold.label }}</label>
                        {{ form.perlin_threshold(required=True, min=0.0, max=1.0, step=0.01, type="number") }}
                        <span class="help-text">Threshold for pixel replacement (0.0-1.0, higher = less replacement)</span>
                    </div>
                    <div class="form-group">
                        <label class="required-field">{{ form.perlin_octaves.label }}</label>
                        {{ form.perlin_octaves(required=True, min=1, max=8, type="number") }}
                        <span class="help-text">Number of octaves (1=smooth curves, 8=detailed noise)</span>
                    </div>
                </div>
                
                <!-- Voronoi fields -->
                <div id="voronoi_fields" class="nested-fields" style="display: none;">
                    <div class="form-group">
                        <div class="alert alert-info">
                            <strong>About Voronoi Cells:</strong> Creates a geometric pattern of angular cells with straight edges, randomly assigning each cell to show either the primary or secondary image. This creates a striking crystalline composite effect.
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="required-field">{{ form.voronoi_cells.label }}</label>
                        {{ form.voronoi_cells(required=True, min=10, max=500, type="number") }}
                        <span class="help-text">Number of cells (10-500, higher = more detailed pattern with smaller cells)</span>
                    </div>
                    <div class="form-group">
                        <label>{{ form.mask_random_seed.label }}</label>
                        {{ form.mask_random_seed(min=1, max=9999, type="number") }}
                        <span class="help-text">Seed for random pattern generation (same seed = same pattern)</span>
                    </div>
                </div>
            </div>
            
            <div class="content-block form-buttons-block">
                <button type="submit" id="process-button">Process Image</button>
                <button type="button" id="reset-button">Reset Form</button>
            </div>
        </form>
    </div>
    
    <!-- Image Preview Section -->
    <div class="image-preview" id="image-preview">
        <h2>Image Preview</h2>
        <div class="preview-container">
            <div class="preview-box" id="processed-container" style="display:none;">
                <h3>Processed Image</h3>
                <img id="processed-preview" src="" alt="Processed Image">
                <div class="action-buttons">
                    <a id="download-link" href="" download>Download Processed Image</a>
                    <button id="use-processed-button" type="button">Use as Input Image</button>
                </div>
            </div>
            <div class="preview-box">
                <h3>Original Image</h3>
                <img id="original-preview" src="" alt="Original Image">
            </div>
        </div>
    </div>
    
    <!-- Debug Info Section -->
    <div class="debug-info" id="debug-info">
        <h3>Debug Information</h3>
        <div id="debug-content"></div>
    </div>
    
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        // Handle sort mode selection to show/hide diagonal fields
        $(document).ready(function() {
            $('#sort_mode').change(function() {
                var sortMode = $(this).val();
                if (sortMode === 'diagonal') {
                    $('#diagonal_fields').show();
                } else {
                    $('#diagonal_fields').hide();
                }
            });
            
            // Trigger change on page load to set initial state
            $('#sort_mode').trigger('change');
            
            // Trigger the effect selection change on page load
            $('#effect').trigger('change');
        });
    </script>
</body>
</html>